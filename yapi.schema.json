{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://yapit.dev/schema/v1",
  "title": "yapit Configuration",
  "description": "Schema for yapit YAML API testing configuration files (HTTP and gRPC)",
  "type": "object",
  "required": ["url"],
  "properties": {
    "url": {
      "type": "string",
      "description": "Base URL for the API request. Use http://, https:// for HTTP/REST, grpc://, grpcs:// for gRPC",
      "format": "uri",
      "examples": [
        "http://localhost:3000",
        "https://api.example.com",
        "grpc://localhost:50051",
        "grpcs://api.example.com:443"
      ]
    },
    "path": {
      "type": "string",
      "description": "Path to append to the base URL (HTTP only)",
      "default": "",
      "examples": [
        "/api/users",
        "/posts/123"
      ]
    },
    "method": {
      "type": "string",
      "description": "HTTP method for the request (HTTP only)",
      "enum": ["GET", "POST", "PUT", "PATCH", "DELETE", "HEAD", "OPTIONS", "grpc"],
      "default": "GET"
    },
    "content_type": {
      "type": "string",
      "description": "Content-Type header for the request (HTTP only, required when body or json is present)",
      "enum": ["application/json"],
      "examples": ["application/json"]
    },
    "body": {
      "type": "object",
      "description": "Request body as YAML structure (converted to JSON). Mutually exclusive with 'json' field.",
      "additionalProperties": true
    },
    "json": {
      "type": "string",
      "description": "Raw JSON literal for request body (HTTP only). Mutually exclusive with 'body' field.",
      "examples": [
        "{\n  \"id\": 123,\n  \"name\": \"example\"\n}"
      ]
    },
    "proto": {
      "type": "string",
      "description": "Proto file name (required for gRPC)",
      "examples": [
        "hello_world.proto",
        "api.proto"
      ]
    },
    "proto_path": {
      "type": "string",
      "description": "Directory containing proto files (required for gRPC). Can be relative or absolute path.",
      "examples": [
        "./proto",
        "../protos",
        "/path/to/protos"
      ]
    },
    "service": {
      "type": "string",
      "description": "Full gRPC service name (required for gRPC, format: package.ServiceName)",
      "examples": [
        "helloworld.Greeter",
        "api.v1.UserService"
      ]
    },
    "rpc": {
      "type": "string",
      "description": "RPC method name to call (required for gRPC)",
      "examples": [
        "SayHello",
        "GetUser",
        "CreatePost"
      ]
    },
    "plaintext": {
      "type": "boolean",
      "description": "Force plaintext/insecure mode for gRPC (optional, auto-detected from grpc:// scheme)",
      "default": false
    },
    "insecure": {
      "type": "boolean",
      "description": "Skip TLS certificate verification for gRPC (optional, for grpcs:// only)",
      "default": false
    },
    "metadata": {
      "type": "object",
      "description": "gRPC metadata (headers) as key-value pairs",
      "additionalProperties": {
        "type": "string"
      },
      "examples": [
        {
          "authorization": "Bearer token123",
          "request-id": "abc-123"
        }
      ]
    }
  },
  "allOf": [
    {
      "if": {
        "allOf": [
          {
            "anyOf": [
              { "required": ["body"] },
              { "required": ["json"] }
            ]
          },
          {
            "not": {
              "properties": {
                "url": {
                  "pattern": "^grpcs?://"
                }
              }
            }
          }
        ]
      },
      "then": {
        "required": ["content_type"]
      }
    },
    {
      "if": {
        "properties": {
          "url": {
            "pattern": "^grpcs?://"
          }
        }
      },
      "then": {
        "required": ["proto", "proto_path", "service", "rpc"],
        "properties": {
          "method": {
            "const": "grpc"
          }
        }
      },
      "else": {
        "required": ["method"],
        "properties": {
          "method": {
            "enum": ["GET", "POST", "PUT", "PATCH", "DELETE", "HEAD", "OPTIONS"]
          }
        }
      }
    }
  ],
  "oneOf": [
    {
      "required": ["body"],
      "not": { "required": ["json"] }
    },
    {
      "required": ["json"],
      "not": { "required": ["body"] }
    },
    {
      "not": {
        "anyOf": [
          { "required": ["body"] },
          { "required": ["json"] }
        ]
      }
    }
  ],
  "examples": [
    {
      "url": "https://api.example.com",
      "path": "/users",
      "method": "GET"
    },
    {
      "url": "https://api.example.com",
      "path": "/users",
      "method": "POST",
      "content_type": "application/json",
      "body": {
        "name": "John Doe",
        "email": "john@example.com"
      }
    },
    {
      "url": "https://api.example.com",
      "path": "/data",
      "method": "POST",
      "content_type": "application/json",
      "json": "{\n  \"id\": 123,\n  \"status\": \"active\"\n}"
    },
    {
      "url": "grpc://localhost:50051",
      "method": "grpc",
      "proto": "hello_world.proto",
      "proto_path": "./proto",
      "service": "helloworld.Greeter",
      "rpc": "SayHello",
      "body": {
        "name": "World"
      }
    }
  ]
}
